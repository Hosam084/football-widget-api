<!doctype html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <style>
        /* ... (Ù…Ù„ÙØ§Øª CSS Ø§Ù„ØªÙŠ Ø£Ø±Ø³Ù„ØªÙ‡Ø§ Ø³Ø§Ø¨Ù‚Ø§Ù‹ Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ... */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }
        /* ... (Ø¨Ù‚ÙŠÙ‡ Ø£ÙƒÙˆØ§Ø¯ CSS) ... */
    </style>
</head>
<body>
    <div class="matches-widget">
        <div class="date-filter">
            <button data-day="yesterday">Ø£Ù…Ø³</button>
            <button class="active" data-day="today">Ø§Ù„ÙŠÙˆÙ…</button>
            <button data-day="tomorrow">ØºØ¯Ø§Ù‹</button>
        </div>
        <select id="leagueFilter" class="league-filter">
            <option value="all">ÙƒÙ„ Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª</option>
        </select>
        <div class="matches-container" id="matchesContainer"></div>
    </div>
    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const c = document.getElementById("matchesContainer"),
                d = document.querySelector(".date-filter"),
                f = document.getElementById("leagueFilter");
            
            let g = "today",
                a = []; 

            function p(m) {
                const l = [...new Set(m.map(i => i.league).filter(l => l && l.trim() !== ''))];
                f.innerHTML = '<option value="all">ÙƒÙ„ Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª</option>';
                l.forEach(l => {
                    const opt = document.createElement("option");
                    opt.value = l;
                    opt.textContent = l;
                    f.appendChild(opt)
                })
            }
            
            d.addEventListener("click", function (e) {
                if (e.target.tagName === "BUTTON") {
                    document.querySelectorAll(".date-filter button").forEach(b => b.classList.remove("active"));
                    e.target.classList.add("active");
                    g = e.target.dataset.day;
                    h()
                }
            });
            f.addEventListener("change", () => h());

            // Ø¯Ø§Ù„Ø© ÙÙ„ØªØ±Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª (Ù…Ø¹ ØªØµØ­ÙŠØ­ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªØ§Ø±ÙŠØ®)
            function h() {
                if (a.length === 0) {
                    c.innerHTML = '<div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª...</div>';
                    return
                }
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                let filtered = a.filter(m => {
                    // ğŸ›‘ Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„Ø­Ø§Ø³Ù…: ØªØ­ÙˆÙŠÙ„ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„ÙŠØªÙ…ÙƒÙ† Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù† Ù‚Ø±Ø§Ø¡ØªÙ‡
                    // ÙŠÙ‚ÙˆÙ… Ø¨ØªØ­ÙˆÙŠÙ„ "YYYY-MM-DD HH:MM" Ø¥Ù„Ù‰ "YYYY-MM-DDT HH:MM:00"
                    const isoDate = m.date.replace(/(\d+)-(\d+)-(\d+)\s(\d+:\d+)/, '$1-$2-$3T$4:00'); 
                    const md = new Date(isoDate);

                    if (isNaN(md.getTime())) return !1; // Ø§Ø³ØªØ®Ø¯Ø§Ù… .getTime() Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
                    
                    md.setHours(0, 0, 0, 0);
                    const diff = Math.round((md - today) / (1e3 * 60 * 60 * 24));
                    if (g === "today") return diff === 0;
                    if (g === "yesterday") return diff === -1;
                    if (g === "tomorrow") return diff === 1;
                    return !1
                });
                
                if (f.value !== "all") filtered = filtered.filter(m => m.league === f.value);
                if (filtered.length === 0) {
                    c.innerHTML = '<div class="loading">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª</div>';
                    return
                }
                const sorted = filtered.sort((a, b) => new Date(a.date) - new Date(b.date));
                L(sorted)
            }
            
            function L(m) {
                // ... (Ø¨Ù‚ÙŠÙ‡ Ø§Ù„ÙƒÙˆØ¯ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ...
                c.innerHTML = "";
                m.forEach(m => {
                    const card = document.createElement("div");
                    
                    card.id = `match-${m.matchId}`; 
                    
                    card.className = "match-card";
                    const md = new Date(m.date),
                        timeString = md.toLocaleTimeString("ar-EG", {
                            hour: "2-digit",
                            minute: "2-digit"
                        });
                    let statusClass, statusText, centerContent;
                    const status = (m.status || "").trim().toLowerCase();
                    if (status.includes("Ù…Ø¨Ø§Ø´Ø±")) {
                        statusClass = "status-live";
                        statusText = "Ù…Ø¨Ø§Ø´Ø±";
                        centerContent = `<div class="score" id="score-${m.matchId}">${m.scoreHome||"0"} - ${m.scoreAway||"0"}</div>`
                    } else if (status.includes("Ø§Ù†ØªÙ‡Øª") || status.includes("finished") || status.includes("ft")) {
                        statusClass = "status-finished";
                        statusText = "Ø§Ù†ØªÙ‡Øª";
                        centerContent = `<div class="score" id="score-${m.matchId}">${m.scoreHome||"0"} - ${m.scoreAway||"0"}</div>`
                    } else {
                        statusClass = "status-upcoming";
                        statusText = "Ù„Ù… ØªØ¨Ø¯Ø£";
                        centerContent = `<div class="center-time">${timeString}</div>`
                    }
                    card.innerHTML = `<div class="match-header"><span class="league-name">${m.league}</span></div><div class="team home">${m.homeLogo?`<img src="${m.homeLogo}" class="team-logo">`:``}<span class="team-name">${m.homeTeam}</span></div><div class="match-center"><div class="status ${statusClass}" id="status-${m.matchId}">${statusText}</div>${centerContent}</div><div class="team away">${m.awayLogo?`<img src="${m.awayLogo}" class="team-logo">`:``}<span class="team-name">${m.awayTeam}</span></div>`;
                    c.appendChild(card)
                })
            }
            
            // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙŠ ØµÙØ­Ø© HTML
            function updateDOMWithMatchData(matches) {
                matches.forEach(match => {
                    const scoreElement = document.getElementById(`score-${match.matchId}`);
                    const statusElement = document.getElementById(`status-${match.matchId}`);

                    if (scoreElement) {
                        scoreElement.textContent = `${match.scoreHome} - ${match.scoreAway}`;
                    }
                    
                    if (statusElement) {
                         const status = (match.status || "").trim().toLowerCase();
                         let statusClass, statusText;
                         
                         if(status.includes("Ù…Ø¨Ø§Ø´Ø±")) {
                            statusClass = "status-live";
                            statusText = "Ù…Ø¨Ø§Ø´Ø±";
                         } else if (status.includes("Ø§Ù†ØªÙ‡Øª") || status.includes("finished") || status.includes("ft")) {
                            statusClass = "status-finished";
                            statusText = "Ø§Ù†ØªÙ‡Øª";
                         } else {
                            statusClass = "status-upcoming";
                            statusText = "Ù„Ù… ØªØ¨Ø¯Ø£";
                         }
                         
                         statusElement.textContent = statusText;
                         statusElement.className = `status ${statusClass}`;
                    }
                });
            }

            // Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† matches.json
            function fetchAndUpdateMatches() {
                // ğŸ›‘ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³Ø§Ø± ØµØ­ÙŠØ­: '/matches.json'
                fetch('/matches.json?t=' + new Date().getTime()) 
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (a.length === 0) {
                             a = data; 
                             p(a);    
                             h();     
                        } else {
                            updateDOMWithMatchData(data);
                            a = data; 
                        }
                    })
                    .catch(error => {
                        console.error("Error during live update:", error);
                        if (a.length === 0) {
                            c.innerHTML = '<div class="error">ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.</div>';
                        }
                    });
            }
            
            fetchAndUpdateMatches();
            setInterval(fetchAndUpdateMatches, 30000); 

        });
    </script>
</body>
</html>
